<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>biblioteca CETIS 111</title>
</head>
<body>
    <header>
        <div class="audio">
            <audio id="audio" source src="perfect-beauty-191271.mp3"></audio>
            <button class="play" onclick="togglePlayPause()"><img class="on" id="play" src="img/apagado.png" onclick="cambiarImagen()"></button>
        </div>
        <div class="contenedorTitulop"> <h1 class="tituloPrincipal">PROGRAMACIÓN</h1> </div>
        <img class="logo-imagen" src="logo.png" alt="logo-imagen">
    </header>
    <h1 class="relleno">PROGRAMACIÓN</h1>
    
    <div class="contenedorBuscador1">
        <input type="text" id="searchInput" placeholder="Buscar libros..." onkeyup="searchBooks()">
        <button class="limpiarBuscador" onclick="clearSearchInput()">Limpiar</button>
    </div>
    
        <div class="contenedorBuscaLetras">
            <label class="buscador_primera_letra">Buscar por primera letra del título:</label>
            <input type="text" id="searchInput2" maxlength="1">
        </div>
    
        <!-- Botón para abrir el formulario modal -->
    <button id="openFormButton">Nuevo Libro</button>
    <button id="removeLastBookButton">Eliminar último libro</button>

    <!-- Modal para agregar libros -->
    <div id="addBookModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <form id="addBookFormProg">
                <h1>Formulario para agregar libros:</h1>
                <label>Agrega la portada del libro:</label>
                <input type="text" id="bookImage" placeholder="URL de la imagen de portada del libro (debe terminar en el tipo de imagen que es)" required>
                <input type="text" id="bookAuthor" placeholder="Autor del libro" required>
                <input type="text" id="bookTitle" placeholder="Título del libro" required>
                <input type="number" id="year" placeholder="Año (opcional)" min="0">
                <input type="text" id="bookCity" placeholder="Ciudad" required>
                <input type="text" id="bookEditorial" placeholder="Editorial" required>
                <input type="text" id="bookLink" placeholder="URL del PDF del libro" required>
                <button type="submit">Agregar Libro</button>
            </form>
        </div>
    </div>

    <!-- Sección de libros -->
    <div id="SectionNewBooks">
        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src="JavaScript novice to ninja.png"></center>
            <h2 class="titulos">Javascript novice to ninja</h2>
            <center><p class="autor">Autor: Jones D.</p></center>
            <center><a href="https://www.google.com/url?sa=t&source=web&rct=j&opi=89978449&url=https://files.gitter.im/FreeCodeCamp/LetsPair/giGZ/Javascript_-Novice-to-Ninja---Darren-Jones.pdf&ved=2ahUKEwi3sZz1lpGGAxWUGEQIHQ2rAW04ChAWegQIDBAB&usg=AOvVaw27kVeBzPCuG7Z7GVlpJE-H"><button>Ver Libro</button></a></center>
        </div>
    
        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src="JavaScript Inspirate.png"></center>
            <h2 class="titulos"> Javascript ¡Inspirate!</h2>
            <center><p class="autor">Autor: Gascón U.</p></center>
            <center><a href="https://www.google.com/url?sa=t&source=web&rct=j&opi=89978449&url=https://www.academia.edu/39508774/JavaScript_Insp%25C3%25ADrate&ved=2ahUKEwj6hpzHl5GGAxXjh-4BHU38D804FBAWegQIFhAB&usg=AOvVaw02sUNZAVdtxMo2byfeFO6t"><button>Ver Libro</button></a></center>
        </div>
        

        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src="aprendizaje kotlin.png"></center>
            <h2 class="titulos">Aprendizaje Kotlin</h2>
            <center><p class="autor">Autor: JetBrains</p></center>
            <center><a href="https://www.google.com/url?sa=t&source=web&rct=j&opi=89978449&url=https://riptutorial.com/Download/kotlin-es.pdf&ved=2ahUKEwjCiaiQmJGGAxV_38kDHfTyAPAQFnoECA8QAQ&usg=AOvVaw39LlYZ8KfXjgKXbAqCd2T_"><button>Ver Libro</button></a></center>    
        </div>
        
        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src="la biblia de C.png"></center>
            <h2 class="titulos"> La biblia de c#</h2>
            <center><p class="autor">Autor: Ferguson J.</p></center>
            <center><a href="https://www.google.com/url?sa=t&source=web&rct=j&opi=89978449&url=https://norbertomn.files.wordpress.com/2014/09/anaya1-la-biblia-de-c__libro-programacion-espa_ol__muestras_gratis_para_que_pruebes_en_tu_cas.pdf&ved=2ahUKEwiRrYLpnZGGAxUHHNAFHXlmB9oQFnoECBsQAQ&usg=AOvVaw07cuHb_wMUYQtajTMuf1xa"><button>Ver Libro</button></a></center>
        </div>

        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src="intro algoritmos prog.png"></center>
            <h2 class="titulos">Introducción a los algoritmos</h2>
            <center><p class="autor">Autor: Palacios J.</p></center>
            <center><a href="https://www.google.com/url?sa=t&source=web&rct=j&opi=89978449&url=https://lmmaa.files.wordpress.com/2010/02/introduccion-a-los-algoritmos.pdf&ved=2ahUKEwi9tYX4lJGGAxVpJUQIHV0sCZAQFnoECBMQAQ&usg=AOvVaw17xVnWJioEa9szjNX45rFe"><button>Ver Libro</button></a></center>
        </div>
        
        
        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src="guia java docentes.png"></center>
            <h2 class="titulos">Java nivel 1 Guia para docentes</h2>
            <center><p class="autor">Autor: Alvarello D.y Pastor G.</p></center>
            <center><a href="https://www.google.com/url?sa=t&source=web&rct=j&opi=89978449&url=https://www.academia.edu/3646670/Guia_para_java&ved=2ahUKEwiC1OOTkZGGAxXYBEQIHfIADtk4ChAWegQIBhAB&usg=AOvVaw0SM_RJDejV_NZ3eQ_DRJi2"><button>Ver Libro</button></a></center>
        </div>
        
        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src="HTML Y CSS.png"></center>
        <h2 class="titulos">HTML & CSS design and build websites</h2>
        <center><p class="autor">Autor: Duckett J.</p></center>
        <center><a href="https://www.google.com/url?sa=t&source=web&rct=j&opi=89978449&url=https://docs.google.com/file/d/0Bw3wxkVchYjNOVNSR1VWRDlQZUU/edit&ved=2ahUKEwj8g__rkZGGAxVSMEQIHZk2CHIQFnoECAQQAQ&usg=AOvVaw1piOEANovt0hOVBPLX3UMc"><button>Ver Libro</button></a></center>
        </div>
        
        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src="problemario algoritmos resueltos.png"></center>
            <h2 class="titulos">Algoritmos resueltos con diagramas de flujo y pseudocódigo</h2>
            <center><p class="autor">Autor: Delgado F. J.</p></center>
            <center><a href="https://editorial.uaa.mx/docs/algoritmos.pdf"><button>Ver Libro</button></a></center>
        </div>
        
        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src="aprenda a programar desde cero.png"></center>
            <h2 class="titulos">Aprender a Programar como si estuvieras en primero</h2>
            <center><p class="autor">Autor: AGUINAGA I., MARTÍNEZ G. , DÍAZ J.</p></center>
            <center><a href="https://www.academia.edu/21713689/APRENDE_A_PROGRAMAR_DESDE_CERO"><button>Ver Libro</button></a></center>
        </div>
        
        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src="bases de datos.png"></center>
            <h2 class="titulos">Base de datos diseños implementación y administración (9na ed.)</h2>
            <center><p class="autor">Autor: Rob P., Coronel C., Steven M.</p></center>
            <center><a href="https://www.academia.edu/36272798/BASES_DE_DATOS_N_O_V_E_N_A_E_D_I_C_I_Ó_N"><button>Ver Libro</button></a></center>
        </div>
    
        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src="cliente2.png"></center>
            <h2 class="titulos">Programación en Internet: clientes web</h2>
            <center><p class="autor">Autor: Lujan S.</p></center>
            <center><a href="https://sergiolujanmora.es/materiales/pi-cliente-muestra.pdf"><button>Ver Libro</button></a></center>
        </div>
        <!--Aqui apareceran los libros agregados-->
    </div>

    <div class="referencias">
        <a href="biblioteca 2.html" class="boton">Inicio</a>
    </div>
    
    <script src="script.js"></script>
    <script>
        // Función para cargar libros desde el almacenamiento local
function loadBooksFromStorage() {
    const books = JSON.parse(localStorage.getItem('books')) || [];
    const validBooks = books.filter(book =>
        book.title && book.author && book.image && book.url
    );

    // Ordenar los libros por el título alfabéticamente
    validBooks.sort((a, b) => {
    const titleA = a.title.toLowerCase();
    const titleB = b.title.toLowerCase();
    if (titleA < titleB) return -1;
    if (titleA > titleB) return 1;
    return 0;
});

    // Agregar cada libro ordenado a la página
    validBooks.forEach(book => addBookToPage(book));
}

// Función para agregar un libro y su referencia
function addBookAndReference(newBook) {
    // Verificar si el libro ya está en la lista de libros mostrados
    const books = document.querySelectorAll('.libro');
    for (let i = 0; i < books.length; i++) {
        const book = books[i];
        const titleElement = book.querySelector('.titulos');
        const authorElement = book.querySelector('.autor');

        if (titleElement.innerText.toLowerCase() === newBook.title.toLowerCase() &&
            authorElement.innerText.toLowerCase().includes(newBook.author.toLowerCase())) {
            alert('El libro ya está en la lista.');
            return;
        }
    }

    // Verificar si la referencia ya existe en el almacenamiento local
    const references = JSON.parse(localStorage.getItem('references')) || [];
    for (let i = 0; i < references.length; i++) {
        const reference = references[i];
        if (reference.title.toLowerCase() === newBook.title.toLowerCase() &&
            reference.author.toLowerCase().includes(newBook.author.toLowerCase())) {
            alert('La referencia ya existe.');
            return;
        }
    }

    // Si no existe, agregar el libro y guardar la referencia
    addBookToPage(newBook);
    saveBookAndReference(newBook);
}

// Evento para el formulario de agregar libros
document.addEventListener('DOMContentLoaded', function() {
    loadBooksFromStorage();

    document.getElementById('addBookFormProg').addEventListener('submit', function(event) {
        event.preventDefault();

        const image = document.getElementById('bookImage').value;
        const author = document.getElementById('bookAuthor').value;
        const title = document.getElementById('bookTitle').value;
        const city = document.getElementById('bookCity').value;
        const editorial = document.getElementById('bookEditorial').value;
        const url = document.getElementById('bookLink').value;
        const newBook = {
            image,
            author,
            title,
            city,
            editorial,
            url,
        };

        addBookAndReference(newBook);

        // Limpiar el formulario y cerrar el modal
        document.getElementById('addBookFormProg').reset();
        document.getElementById('addBookModal').style.display = 'none';
    });

    // Evento para el campo de búsqueda
    document.getElementById('searchInput').addEventListener('input', searchBooks);

    // Nueva funcionalidad para el modal
    const modal = document.getElementById('addBookModal');
    const btn = document.getElementById('openFormButton');
    const span = document.getElementsByClassName('close')[0];

    // Cuando el usuario hace clic en el botón, abre el modal
    btn.onclick = function() {
        modal.style.display = 'block';
    }

    // Cuando el usuario hace clic en la "x", cierra el modal
    span.onclick = function() {
        modal.style.display ='none';
    }

    // Cuando el usuario hace clic fuera del modal, cierra el modal
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    }
});

// Función para agregar un libro a la página
function addBookToPage(book) {
    const newBookDiv = document.createElement('div');
    newBookDiv.classList.add('libro');
    newBookDiv.innerHTML = `
        <center><img class="contenedor-imagenes-libros" src="${book.image}"></center>
        <h2 class="titulos">${book.title}</h2>
        <center><p class="autor">Autor: ${book.author}</p></center>
        <center><a href="${book.url}"><button>Ver Libro</button></a></center>
    `;
    document.querySelector('#SectionNewBooks').appendChild(newBookDiv);
}

// Función para guardar un libro y su referencia en el almacenamiento local
function saveBookAndReference(book) {
    const books = JSON.parse(localStorage.getItem('books')) || [];
    books.push(book);
    localStorage.setItem('books', JSON.stringify(books));

    const reference = createReference(book);
    const references = JSON.parse(localStorage.getItem('references')) || [];
    references.push(reference);
    localStorage.setItem('references', JSON.stringify(references));
}

// Función para crear una referencia APA a partir de un libro
function createReference(book) {
    const year = document.getElementById('year').value || 'S.F.'; // Si no hay año, usar "S.F."
    const reference = {
        title: book.title,
        author: book.author,
        date: `(${year})`,
        city: book.city,
        editorial: book.editorial,
        url: book.url
    };
    return reference;
}
    </script>
</body>
</html>
