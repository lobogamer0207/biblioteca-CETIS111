<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>biblioteca CETIS 111</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js"></script>
</head>
<body>
    <!-- Resto de tu código HTML -->
    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "TU_API_KEY",
            authDomain: "TU_AUTH_DOMAIN",
            databaseURL: "TU_DATABASE_URL",
            projectId: "TU_PROJECT_ID",
            storageBucket: "TU_STORAGE_BUCKET",
            messagingSenderId: "TU_MESSAGING_SENDER_ID",
            appId: "TU_APP_ID"
        };

        // Inicializar Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Función para cargar libros desde `localStorage`
        function loadBooksFromLocalStorage() {
            const books = JSON.parse(localStorage.getItem('books_ingles')) || [];
            for (const book of books) {
                addBookToPage(book);
            }
        }

        // Función para cargar libros desde Firebase
        function loadBooksFromDatabase() {
            const booksRef = firebase.database().ref('books_ingles');
            booksRef.once('value', (snapshot) => {
                const books = snapshot.val();
                for (const id in books) {
                    if (books.hasOwnProperty(id)) {
                        addBookToPage(books[id]);
                    }
                }
            });
        }

        // Función para migrar libros de `localStorage` a Firebase
        function migrateBooksToDatabase() {
            const books = JSON.parse(localStorage.getItem('books_ingles')) || [];
            const booksRef = firebase.database().ref('books_ingles');
            for (const book of books) {
                const newBookRef = booksRef.push();
                newBookRef.set(book);
            }
            // Una vez migrados, puedes limpiar el `localStorage` si lo deseas
            // localStorage.removeItem('books_ingles');
        }

        // Función para agregar un libro a la página
        function addBookToPage(book) {
            const newBookDiv = document.createElement('div');
            newBookDiv.classList.add('libro');
            newBookDiv.innerHTML = `
                <center><img class="contenedor-imagenes-libros" src="${book.image}"></center>
                <h2 class="titulos">${book.title}</h2>
                <center><p class="autor">Autor: ${book.author}</p></center>
                <center><a href="${book.url}"><button>Ver Libro</button></a></center>
            `;
            document.querySelector('#SectionNewBooks').appendChild(newBookDiv);
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadBooksFromLocalStorage();
            loadBooksFromDatabase();
            migrateBooksToDatabase();

            document.getElementById('addBookForm').addEventListener('submit', function(event) {
                event.preventDefault();
                const image = document.getElementById('bookImage').value;
                const author = document.getElementById('bookAuthor').value;
                const title = document.getElementById('bookTitle').value;
                const city = document.getElementById('bookCity').value;
                const editorial = document.getElementById('bookEditorial').value;
                const url = document.getElementById('bookLink').value;
                const newBook = { image, author, title, city, editorial, url };

                addBookToPage(newBook);
                saveBookToDatabase(newBook);
                document.getElementById('addBookForm').reset();
                document.getElementById('addBookModal').style.display = 'none';
            });

            document.getElementById('searchInput').addEventListener('input', searchBooks);

            const modal = document.getElementById('addBookModal');
            const btn = document.getElementById('openFormButton');
            const span = document.getElementsByClassName('close')[0];

            btn.onclick = function() { modal.style.display = 'block'; }
            span.onclick = function() { modal.style.display = 'none'; }
            window.onclick = function(event) { if (event.target == modal) modal.style.display = 'none'; }

            function searchBooks() {
                const query = document.getElementById('searchInput').value.toLowerCase();
                const books = document.querySelectorAll('.libro');
                books.forEach(book => {
                    const title = book.querySelector('.titulos').innerText.toLowerCase();
                    book.style.display = title.includes(query) ? '' : 'none';
                });
            }

            function clearSearchInput() {
                document.getElementById('searchInput').value = '';
                searchBooks();
            }
        });

        // Función para guardar un libro en Firebase
        function saveBookToDatabase(book) {
            const booksRef = firebase.database().ref('books_ingles');
            const newBookRef = booksRef.push();
            newBookRef.set(book);
        }
    </script>
</body>
</html>
