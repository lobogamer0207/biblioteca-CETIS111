<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>biblioteca CETIS 111</title>
</head>
<body>
    <header>
        <div class="audio">
            <audio id="audio" source src="perfect-beauty-191271.mp3"></audio>
            <button class="play" onclick="togglePlayPause()"><img class="on" id="play" src="img/apagado.png" onclick="cambiarImagen()"></button>
        </div>
        <div class="contenedorTitulop"> <h1 class="tituloPrincipal">INGLÉS</h1> </div>
        <img class="logo-imagen" src="logo.png" alt="logo-imagen">
    </header>
    <h1 class="relleno">MECATRONICA</h1>
    
    <div class="contenedorBuscador1">
        <input type="text" id="searchInput" placeholder="Buscar libros..." onkeyup="searchBooks()">
        <button class="limpiarBuscador" onclick="clearSearchInput()">Limpiar</button>
    </div>
    
        <div class="contenedorBuscaLetras">
            <label class="buscador_primera_letra">Buscar por primera letra del título:</label>
            <input type="text" id="searchInput2" maxlength="1">
        </div>
    
        <!-- Botón para abrir el formulario modal -->
    <button id="openFormButton">Nuevo Libro</button>
    <button id="removeLastBookButton">Eliminar último libro</button>

    <!-- Modal para agregar libros -->
    <div id="addBookModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <form id="addBookForm">
                <h1>Formulario para agregar libros:</h1>
                <label>Agrega la portada del libro:</label>
                <input type="text" id="bookImage" placeholder="URL de la imagen de portada del libro (debe terminar en el tipo de imagen que es)" required>
                <input type="text" id="bookAuthor" placeholder="Autor del libro" required>
                <input type="text" id="bookTitle" placeholder="Título del libro" required>
                <input type="number" id="year" placeholder="Año (opcional)" min="0">
                <input type="text" id="bookCity" placeholder="Ciudad" required>
                <input type="text" id="bookEditorial" placeholder="Editorial" required>
                <input type="text" id="bookLink" placeholder="URL del PDF del libro" required>
                <button type="submit">Agregar Libro</button>
            </form>
        </div>
    </div>

    <!-- Sección de libros -->
    <div id="SectionNewBooks">

        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src="gramatica-basica-de-la-lengua-inglesa.png"></center>
            <h2 class="titulos">Essential Gramar in Use</h2>
            <center><p class="autor">Autor: Murphy R.</p></center>
            <center><a href="https://www.google.com/url?sa=t&source=web&rct=j&opi=89978449&url=https://www.academia.edu/13501361/SPANISH_Edition_essential_grammar_in_use&ved=2ahUKEwjXmqmhlMiFAxUjJEQIHb8UDBkQFnoECBEQAQ&usg=AOvVaw1z8zN0a0NYUzrWJFpnnjW5"><button>Ver Libro</button></a></center>
        </div>

        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src="Curso de Inglés Vaughan - El Mundo - Libro 1.png"></center>
            <h2 class="titulos">Curso de Inglés</h2>
            <center><p class="autor">Autor: Vaughan R.</p></center>
            <center><a href="https://dokumen.pub/curso-de-ingles-definitivo-principiante-spanish-edition.html"><button>Ver Libro</button></a></center>
        </div>

        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src="Diccionario Ingles Espanol.png"></center>
            <h2 class="titulos">Diccionario de Terminos Geologicos Ingles/Espanol</h2>
            <center><p class="autor">Autor: Draper G. y Gabriel Yannit G.</p></center>
            <center><a href="https://www.academia.edu/12426040/Diccionario_Inglés_Español"><button>Ver Libro</button></a></center>
        </div>

        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src="Guia First Certificate Aprending.png"></center>
            <h2 class="titulos">First certificate: guía completa para el examen</h2>
            <center><p class="autor">Autor: Cambridge</p></center>
            <center><a href="https://www.google.com/url?sa=t&source=web&rct=j&opi=89978449&url=https://www.examenes-cambridge.com/wp-content/uploads/2021/05/Guia-First-Certificate-Aprending.pdf&ved=2ahUKEwjE0uzPx5OGAxWpJUQIHaFBC8wQFnoECBUQAQ&usg=AOvVaw3hUQQD93gxZXEJMKP09N6r"><button>Ver Libro</button></a></center>
        </div>

        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src="fonética inglesa curso completo.png"></center>
            <h2 class="titulos">Fonética de la lengua inglesa</h2>
            <center><p class="autor">Autor: Millán E.</p></center>
            <center><a href="https://www.google.com/url?sa=t&source=web&rct=j&opi=89978449&url=https://www.mercaba.org/SANLUIS/IDIOMAS/Ingl%25C3%25A9s/fon%25C3%25A9tica%2520inglesa_curso%2520completo.pdf&ved=2ahUKEwiCt9DYyJOGAxXaI0QIHRwIDl8QFnoECBMQAQ&usg=AOvVaw1pakvcugWZB3jZUNQzvqLr"><button>Ver Libro</button></a></center>
        </div>

        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src="Frases en ingles para Dummies 2002 Gail.png"></center>
            <h2 class="titulos">Frases en ingles para dummies</h2>
            <center><p class="autor">Autor: Brenner G.</p></center>
            <center><a href="https://www.google.com/url?sa=t&source=web&rct=j&opi=89978449&url=https://www.academia.edu/39875479/Frases_en_ingl%25C3%25A9s_para_Dummies_2002_Gail_Brenner&ved=2ahUKEwi1lY2nyJOGAxVVIUQIHbt-D80QFnoECCAQAQ&usg=AOvVaw0DTIoaQiMDU4uQEVN2aZ2Q"><button>Ver Libro</button></a></center>
        </div>

        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src="Curso de Inglés Vaughan - El Mundo - Libro 3.png"></center>
            <h2 class="titulos">Ingles el curso definitivo vaughan. (3 ed.)</h2>
            <center><p class="autor">Autor: Vaughan R.</p></center>
            <center><a href="https://www.google.com/url?sa=t&source=web&rct=j&opi=89978449&url=https://gravepa.com/granaino/biblioteca/aprende/Idiomas/Curso%2520de%2520Ingles%2520Vaughan%2520-%2520CD1%2520a%2520CD41%2520y%2520Libros%25201%2520a%252041/Curso%2520de%2520Ingl%25C3%25A9s%2520Vaughan%2520-%2520CD1%2520a%2520CD41%2520y%2520Libros%25201%2520a%252041/Curso%2520de%2520Ingles%2520Vaughan%2520-%2520El%2520Mundo_CD%25201%2520a%252020%2520libros%25201%2520a%252012/Curso%2520de%2520Ingl%25C3%25A9s%2520Vaughan%2520-%2520El%2520Mundo%2520-%2520Libro%25203.pdf&ved=2ahUKEwi_gqymtJOGAxU8JEQIHe1HAvMQFnoECCsQAQ&usg=AOvVaw2pQt4NpwwVBRnknE5iznBS"><button>Ver Libro</button></a></center>
        </div>

        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src="Ingles2-Daniel Welsch.png"></center>
            <h2 class="titulos">Inglés Básico 2</h2>
            <center><p class="autor">Autor: Welsch D.</p></center>
            <center><a href="https://www.google.com/url?sa=t&source=web&rct=j&opi=89978449&url=https://www.aprendemasingles.com/wp-content/uploads/2018/01/Ingle%25CC%2581s-Ba%25CC%2581sico-2-daniel-welsch-PDF-capi%25CC%2581tulo-gratis.pdf&ved=2ahUKEwjV5oaBksiFAxWvHEQIHVA9CBgQFnoECAUQAQ&usg=AOvVaw0rA-ScZhcB79xd77Ivokd9"><button>Ver Libro</button></a></center>
        </div>

        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src="ingles-en-la-vida-diaria.png"></center>
            <h2 class="titulos">Inglés en la vida diaria</h2>
            <center><p class="autor">Autor: Delgado J.</p></center>
            <center><a href="https://www.google.com/url?sa=t&source=web&rct=j&opi=89978449&url=https://epja.mineduc.cl/wp-content/uploads/sites/43/2019/06/Gu%25C3%25ADa-N%25C2%25B0-1-Ingl%25C3%25A9s-El-ingl%25C3%25A9s-en-la-vida-diaria-OK.pdf&ved=2ahUKEwjMz_iNk8iFAxU3HUQIHSzqCxgQFnoECAQQAQ&usg=AOvVaw3hRv0-1smve1YipQkr3heM"><button>Ver Libro</button></a></center>
        </div>

        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src=""></center>
            <h2 class="titulos">Inglés para Dummles</h2>
            <center><p class="autor">Autor: Brenner G.</p></center>
            <center><a href="https://www.google.com/url?sa=t&source=web&rct=j&opi=89978449&url=https://ftp.isdi.co.cu/Biblioteca/BIBLIOTECA%2520UNIVERSITARIA%2520DEL%2520ISDI/COLECCION%2520DE%2520LIBROS%2520ELECTRONICOS/LE-1571/LE-1571.pdf&ved=2ahUKEwjf_p29isiFAxUYKEQIHXcRBxcQFnoECBUQAQ&usg=AOvVaw1S8Chv2836BCY6-HFyX12L"><button>Ver Libro</button></a></center>
        </div>

        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src="new HEADWAY beginner student book.png"></center>
            <h2 class="titulos">New headway beginner student's book</h2>
            <center><p class="autor">Autor: John y Soars L.</p></center>
            <center><a href="https://www.google.com/url?sa=t&source=web&rct=j&opi=89978449&url=https://www.researchgate.net/publication/332591099_new_HEADWAY_beginner_student_book&ved=2ahUKEwiU8p6KypOGAxWKI0QIHfNKD9EQFnoECB4QAQ&usg=AOvVaw1J99muo3fb9k82IuezXFhh"><button>Ver Libro</button></a></center>
        </div>

        <div class="libro">
            <center><img class="contenedor-imagenes-libros" src="Cambridge Preliminary English Test 6_Book.png"></center>
            <h2 class="titulos">Preliminary english test 6 with answers</h2>
            <center><p class="autor">Autor:  University of Cambridge Local Examinations Syndicate</p></center>
            <center><a href="https://www.google.com/url?sa=t&source=web&rct=j&opi=89978449&url=https://www.tedbodrum.k12.tr/dosya/hazirlikatlamasinavi/Cambridge%2520Preliminary%2520English%2520Test%25206_Book.pdf&ved=2ahUKEwi9vOfSxJOGAxXmKUQIHRNuAisQFnoECB8QAQ&usg=AOvVaw2Pgny3D4hkoaxw9dA3WOTW"><button>Ver Libro</button></a></center>
        </div>
        <!--Aqui apareceran los libros agregados-->
    </div>

    <div class="referencias">
        <a href="index.html" class="boton">Inicio</a>
    </div>
    
    <script src="script.js"></script>
    <script>
        const materia = 'ingles';

        // Función para cargar libros desde el almacenamiento local
function loadBooksFromStorage() {
    const books = JSON.parse(localStorage.getItem(`books_${materia}`)) || [];
    const validBooks = books.filter(book =>
        book.title && book.author && book.image && book.url
    );

    // Ordenar los libros por el título alfabéticamente
    validBooks.sort((a, b) => {
    const titleA = a.title.toLowerCase();
    const titleB = b.title.toLowerCase();
    if (titleA < titleB) return -1;
    if (titleA > titleB) return 1;
    return 0;
});

    // Agregar cada libro ordenado a la página
    validBooks.forEach(book => addBookToPage(book));
}

// Función para agregar un libro y su referencia
function addBookAndReference(newBook) {
    // Verificar si el libro ya está en la lista de libros mostrados
    const books = document.querySelectorAll('.libro');
    for (let i = 0; i < books.length; i++) {
        const book = books[i];
        const titleElement = book.querySelector('.titulos');
        const authorElement = book.querySelector('.autor');

        if (titleElement.innerText.toLowerCase() === newBook.title.toLowerCase() &&
            authorElement.innerText.toLowerCase().includes(newBook.author.toLowerCase())) {
            alert('El libro ya está en la lista.');
            return;
        }
    }

    // Verificar si la referencia ya existe en el almacenamiento local
    const references = JSON.parse(localStorage.getItem('references')) || [];
    for (let i = 0; i < references.length; i++) {
        const reference = references[i];
        if (reference.title.toLowerCase() === newBook.title.toLowerCase() &&
            reference.author.toLowerCase().includes(newBook.author.toLowerCase())) {
            alert('La referencia ya existe.');
            return;
        }
    }

    // Si no existe, agregar el libro y guardar la referencia
    addBookToPage(newBook);
    saveBookAndReference(newBook);
}

// Evento para el formulario de agregar libros
document.addEventListener('DOMContentLoaded', function() {
    loadBooksFromStorage();

    document.getElementById('addBookForm').addEventListener('submit', function(event) {
        event.preventDefault();

        const image = document.getElementById('bookImage').value;
        const author = document.getElementById('bookAuthor').value;
        const title = document.getElementById('bookTitle').value;
        const city = document.getElementById('bookCity').value;
        const editorial = document.getElementById('bookEditorial').value;
        const url = document.getElementById('bookLink').value;
        const newBook = {
            image,
            author,
            title,
            city,
            editorial,
            url,
        };

        addBookAndReference(newBook);

        // Limpiar el formulario y cerrar el modal
        document.getElementById('addBookForm').reset();
        document.getElementById('addBookModal').style.display = 'none';
    });

    // Evento para el campo de búsqueda
    document.getElementById('searchInput').addEventListener('input', searchBooks);

    // Nueva funcionalidad para el modal
    const modal = document.getElementById('addBookModal');
    const btn = document.getElementById('openFormButton');
    const span = document.getElementsByClassName('close')[0];

    // Cuando el usuario hace clic en el botón, abre el modal
    btn.onclick = function() {
        modal.style.display = 'block';
    }

    // Cuando el usuario hace clic en la "x", cierra el modal
    span.onclick = function() {
        modal.style.display ='none';
    }

    // Cuando el usuario hace clic fuera del modal, cierra el modal
    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = 'none';
        }
    }
});

// Función para agregar un libro a la página
function addBookToPage(book) {
    const newBookDiv = document.createElement('div');
    newBookDiv.classList.add('libro');
    newBookDiv.innerHTML = `
        <center><img class="contenedor-imagenes-libros" src="${book.image}"></center>
        <h2 class="titulos">${book.title}</h2>
        <center><p class="autor">Autor: ${book.author}</p></center>
        <center><a href="${book.url}"><button>Ver Libro</button></a></center>
    `;
    document.querySelector('#SectionNewBooks').appendChild(newBookDiv);
}

// Función para guardar un libro y su referencia en el almacenamiento local
function saveBookAndReference(book) {
    const books = JSON.parse(localStorage.getItem(`books_${materia}`)) || [];
    books.push(book);
    localStorage.setItem(`books_${materia}`, JSON.stringify(books));

    const reference = createReference(book);
    const references = JSON.parse(localStorage.getItem('references')) || [];
    references.push(reference);
    localStorage.setItem('references', JSON.stringify(references));
}

// Función para crear una referencia APA a partir de un libro
function createReference(book) {
    const year = document.getElementById('year').value || 'S.F.'; // Si no hay año, usar "S.F."
    const reference = {
        title: book.title,
        author: book.author,
        date: `(${year})`,
        city: book.city,
        editorial: book.editorial,
        url: book.url
    };
    return reference;
}
    </script>
</body>
</html>
