<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>biblioteca CETIS 111</title>
</head>
<body>
    <header>
        <div class="audio">
            <audio id="audio" source src="perfect-beauty-191271.mp3"></audio>
            <button class="play" onclick="togglePlayPause()"><img class="on" id="play" src="img/apagado.png" onclick="cambiarImagen()"></button>
        </div>
        <div class="contenedorTitulop"> <h1 class="tituloPrincipal">INGLÉS</h1> </div>
        <img class="logo-imagen" src="logo.png" alt="logo-imagen">
    </header>
    <h1 class="relleno">INGLES</h1>
    
    <div class="contenedorBuscador1">
        <input type="text" id="searchInput" placeholder="Buscar libros..." onkeyup="searchBooks()">
        <button class="limpiarBuscador" onclick="clearSearchInput()">Limpiar</button>
    </div>
    
    <div class="contenedorBuscaLetras">
        <label class="buscador_primera_letra">Buscar por primera letra del título:</label>
        <input type="text" id="searchInput2" maxlength="1">
    </div>
    
    <!-- Botón para abrir el formulario modal -->
    <button id="openFormButton">Nuevo Libro</button>
    <button id="removeLastBookButton">Eliminar último libro</button>

    <!-- Modal para agregar libros -->
    <div id="addBookModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <form id="addBookForm">
                <h1>Formulario para agregar libros:</h1>
                <label>Agrega la portada del libro:</label>
                <input type="text" id="bookImage" placeholder="URL de la imagen de portada del libro (debe terminar en el tipo de imagen que es)" required>
                <input type="text" id="bookAuthor" placeholder="Autor del libro" required>
                <input type="text" id="bookTitle" placeholder="Título del libro" required>
                <input type="number" id="year" placeholder="Año (opcional)" min="0">
                <input type="text" id="bookCity" placeholder="Ciudad" required>
                <input type="text" id="bookEditorial" placeholder="Editorial" required>
                <input type="text" id="bookLink" placeholder="URL del PDF del libro" required>
                <button type="submit">Agregar Libro</button>
            </form>
        </div>
    </div>

    <!-- Sección de libros -->
    <div id="SectionNewBooks">
        <!--Aqui apareceran los libros agregados-->
    </div>

    <div class="referencias">
        <a href="biblioteca 2.html" class="boton">Inicio</a>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar libros desde el almacenamiento local
            loadBooksFromStorage();

            // Cargar libros desde el archivo JSON
            fetch('books.json')
                .then(response => response.json())
                .then(data => {
                    data.forEach(book => addBookToPage(book));
                })
                .catch(error => console.error('Error al cargar los libros:', error));
        });

        function loadBooksFromStorage() {
            const books = JSON.parse(localStorage.getItem('books_ingles')) || [];
            books.forEach(book => addBookToPage(book));
        }

        function addBookToPage(book) {
            const newBookDiv = document.createElement('div');
            newBookDiv.classList.add('libro');
            newBookDiv.innerHTML = `
                <center><img class="contenedor-imagenes-libros" src="${book.image}"></center>
                <h2 class="titulos">${book.title}</h2>
                <center><p class="autor">Autor: ${book.author}</p></center>
                <center><a href="${book.url}"><button>Ver Libro</button></a></center>
            `;
            document.querySelector('#SectionNewBooks').appendChild(newBookDiv);
        }

        document.getElementById('addBookForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const image = document.getElementById('bookImage').value;
            const author = document.getElementById('bookAuthor').value;
            const title = document.getElementById('bookTitle').value;
            const city = document.getElementById('bookCity').value;
            const editorial = document.getElementById('bookEditorial').value;
            const url = document.getElementById('bookLink').value;
            const newBook = { image, author, title, city, editorial, url };

            addBookToPage(newBook);
            saveBookToStorage(newBook);
            document.getElementById('addBookForm').reset();
            document.getElementById('addBookModal').style.display = 'none';
        });

        function saveBookToStorage(book) {
            const books = JSON.parse(localStorage.getItem('books_ingles')) || [];
            books.push(book);
            localStorage.setItem('books_ingles', JSON.stringify(books));
        }

        document.getElementById('searchInput').addEventListener('input', searchBooks);

        const modal = document.getElementById('addBookModal');
        const btn = document.getElementById('openFormButton');
        const span = document.getElementsByClassName('close')[0];

        btn.onclick = function() { modal.style.display = 'block'; }
        span.onclick = function() { modal.style.display = 'none'; }
        window.onclick = function(event) { if (event.target == modal) modal.style.display = 'none'; }

        function searchBooks() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const books = document.querySelectorAll('.libro');
            books.forEach(book => {
                const title = book.querySelector('.titulos').innerText.toLowerCase();
                book.style.display = title.includes(query) ? '' : 'none';
            });
        }

        function clearSearchInput() {
            document.getElementById('searchInput').value = '';
            searchBooks();
        }
    </script>
</body>
</html>
